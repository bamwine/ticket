var pluginName="intlTelInput",id=1,defaults={autoFormat:true,autoHideDialCode:true,defaultCountry:"",ipinfoToken:"",nationalMode:true,numberType:"MOBILE",onlyCountries:[],preferredCountries:["us","gb"],utilsScript:""},keys={UP:38,DOWN:40,ENTER:13,ESC:27,PLUS:43,A:65,Z:90,ZERO:48,NINE:57,SPACE:32,BSPACE:8,DEL:46,CTRL:17,CMD1:91,CMD2:224},windowLoaded=false;$(window).load(function(){windowLoaded=true});function Plugin(b,a){this.element=b;this.options=$.extend({},defaults,a);this._defaults=defaults;this.ns="."+pluginName+(id++);this.isGoodBrowser=Boolean(b.setSelectionRange);this.hadInitialPlaceholder=Boolean($(b).attr("placeholder"));this._name=pluginName;this.init()}Plugin.prototype={init:function(){var b=this;if(this.options.defaultCountry=="auto"){this.options.defaultCountry="";var a="//ipinfo.io";if(this.options.ipinfoToken){a+="?token="+this.options.ipinfoToken}$.get(a,function(c){if(c&&c.country){b.options.defaultCountry=c.country.toLowerCase()}},"jsonp").always(function(){b._ready()})}else{this._ready()}},_ready:function(){if(this.options.nationalMode){this.options.autoHideDialCode=false}if(navigator.userAgent.match(/IEMobile/i)){this.options.autoFormat=false}this._processCountryData();this._generateMarkup();this._setInitialState();this._initListeners()},_processCountryData:function(){this._setInstanceCountryData();this._setPreferredCountries()},_addCountryCode:function(b,a,d){if(!(a in this.countryCodes)){this.countryCodes[a]=[]}var c=d||0;this.countryCodes[a][c]=b},_setInstanceCountryData:function(){var b;if(this.options.onlyCountries.length){this.countries=[];for(b=0;b<allCountries.length;b++){if($.inArray(allCountries[b].iso2,this.options.onlyCountries)!=-1){this.countries.push(allCountries[b])}}}else{this.countries=allCountries}this.countryCodes={};for(b=0;b<this.countries.length;b++){var d=this.countries[b];this._addCountryCode(d.iso2,d.dialCode,d.priority);if(d.areaCodes){for(var a=0;a<d.areaCodes.length;a++){this._addCountryCode(d.iso2,d.dialCode+d.areaCodes[a])}}}},_setPreferredCountries:function(){this.preferredCountries=[];for(var c=0;c<this.options.preferredCountries.length;c++){var a=this.options.preferredCountries[c],b=this._getCountryData(a,false,true);if(b){this.preferredCountries.push(b)}}},_generateMarkup:function(){this.telInput=$(this.element);this.telInput.attr("autocomplete","off");this.telInput.wrap($("<div>",{"class":"intl-tel-input"}));var b=$("<div>",{"class":"flag-dropdown"}).insertAfter(this.telInput);var a=$("<div>",{"class":"selected-flag"}).appendTo(b);this.selectedFlagInner=$("<div>",{"class":"flag"}).appendTo(a);$("<div>",{"class":"arrow"}).appendTo(this.selectedFlagInner);this.countryList=$("<ul>",{"class":"country-list v-hide"}).appendTo(b);if(this.preferredCountries.length){this._appendListItems(this.preferredCountries,"preferred");$("<li>",{"class":"divider"}).appendTo(this.countryList)}this._appendListItems(this.countries,"");this.dropdownHeight=this.countryList.outerHeight();this.countryList.removeClass("v-hide").addClass("hide");this.countryList.parents(".intl-tel-input").find("input").removeClass("open");if(window.innerWidth<500){this.countryList.outerWidth(this.telInput.outerWidth())}this.countryListItems=this.countryList.children(".country")},_appendListItems:function(a,e){var d="";for(var b=0;b<a.length;b++){var f=a[b];d+="<li class='country "+e+"' data-dial-code='"+f.dialCode+"' data-country-code='"+f.iso2+"'>";d+="<div class='flag "+f.iso2+"'></div>";d+="<span class='country-name'>"+f.name+"</span>";d+="<span class='dial-code'>+"+f.dialCode+"</span>";d+="</li>"}this.countryList.append(d)},_setInitialState:function(){var a=this.telInput.val();if(this._getDialCode(a)){this._updateFlagFromNumber(a)}else{if(this.options.defaultCountry){this.options.defaultCountry=this._getCountryData(this.options.defaultCountry,false,false)}else{this.options.defaultCountry=(this.preferredCountries.length)?this.preferredCountries[0]:this.countries[0]}this._selectFlag(this.options.defaultCountry.iso2);if(!a){this._updateDialCode(this.options.defaultCountry.dialCode,false)}}if(a){this._updateVal(a,false)}},_initListeners:function(){var c=this;this._initKeyListeners();if(this.options.autoHideDialCode||this.options.autoFormat){this._initFocusListeners()}var b=this.telInput.closest("label");if(b.length){b.on("click"+this.ns,function(d){if(c.countryList.hasClass("hide")){c.telInput.focus()}else{d.preventDefault()}})}var a=this.selectedFlagInner.parent();a.on("click"+this.ns,function(d){if(c.countryList.hasClass("hide")&&!c.telInput.prop("disabled")&&!c.telInput.prop("readonly")){c._showDropdown()}});if(this.options.utilsScript){if(windowLoaded){this.loadUtils()}else{$(window).load(function(){c.loadUtils()})}}},_initKeyListeners:function(){var d=this;if(this.options.autoFormat){var c="keyup";if(/Android/.test(navigator.userAgent)){var a=keypressUA.split(",");for(var b=0;b<a.length;b++){if(navigator.userAgent.indexOf(a[b])>-1){c="keypress"}}}else{c="keypress"}this.telInput.on(c+this.ns,function(k){if(k.which>=keys.SPACE&&!k.metaKey&&window.intlTelInputUtils&&!d.telInput.prop("readonly")){k.preventDefault();var i=((k.which>=keys.ZERO&&k.which<=keys.NINE)||k.which==keys.PLUS),h=d.telInput[0],m=(d.isGoodBrowser&&h.selectionStart==h.selectionEnd),f=d.telInput.attr("maxlength"),l=d.telInput.val(),j=(f)?(l.length<f):true;if(j&&(i||m)){var g=(i)?String.fromCharCode(k.which):null;d._handleInputKey(g,true);if(l!=d.telInput.val()){d.telInput.trigger("input")}}if(!i){d._handleInvalidKey()}}})}this.telInput.on("keyup"+this.ns,function(j){if(j.which==keys.ENTER||d.telInput.prop("readonly")){}else{if(d.options.autoFormat&&window.intlTelInputUtils){var i=(j.which==keys.CTRL||j.which==keys.CMD1||j.which==keys.CMD2),f=d.telInput[0],l=(d.isGoodBrowser&&f.selectionStart==f.selectionEnd),h=(d.isGoodBrowser&&f.selectionStart==d.telInput.val().length);if((j.which==keys.DEL&&!h)||j.which==keys.BSPACE||(i&&l)){d._handleInputKey(null,(i&&h))}if(!d.options.nationalMode){var k=d.telInput.val();if(k.charAt(0)!="+"){var g=(d.isGoodBrowser)?f.selectionStart+1:0;d.telInput.val("+"+k);if(d.isGoodBrowser){f.setSelectionRange(g,g)}}}}else{d._updateFlagFromNumber(d.telInput.val())}}})},_handleInvalidKey:function(){var a=this;this.telInput.trigger("invalidkey").addClass("iti-invalid-key");setTimeout(function(){a.telInput.removeClass("iti-invalid-key")},100)},_handleInputKey:function(e,h){var f=this.telInput.val(),b=this._getClean(f),a,c=this.telInput[0],d=0;if(this.isGoodBrowser){d=this._getDigitsOnRight(f,c.selectionEnd);if(e){f=f.substr(0,c.selectionStart)+e+f.substring(c.selectionEnd,f.length)}else{a=f.charAt(c.selectionStart-1)}}else{if(e){f+=e}}this.setNumber(f,h,true);if(this.isGoodBrowser){var g;f=this.telInput.val();if(!d){g=f.length}else{g=this._getCursorFromDigitsOnRight(f,d);if(!e){g=this._getCursorFromLeftChar(f,g,a)}}c.setSelectionRange(g,g)}},_getCursorFromLeftChar:function(e,d,a){for(var b=d;b>0;b--){var c=e.charAt(b-1);if(c==a||$.isNumeric(c)){return b}}return 0},_getCursorFromDigitsOnRight:function(c,b){for(var a=c.length-1;a>=0;a--){if($.isNumeric(c.charAt(a))){if(--b===0){return a}}}return 0},_getDigitsOnRight:function(d,c){var b=0;for(var a=c;a<d.length;a++){if($.isNumeric(d.charAt(a))){b++}}return b},_initFocusListeners:function(){var a=this;if(this.options.autoHideDialCode){this.telInput.on("mousedown"+this.ns,function(b){if(!a.telInput.is(":focus")&&!a.telInput.val()){b.preventDefault();a.telInput.focus()}})}this.telInput.on("focus"+this.ns,function(c){var b=a.telInput.val();a.telInput.data("focusVal",b);if(a.options.autoHideDialCode&&!b&&!a.telInput.prop("readonly")&&a.selectedCountryData.dialCode){a._updateVal("+"+a.selectedCountryData.dialCode,true);a.telInput.one("keypress.plus"+a.ns,function(f){if(f.which==keys.PLUS){var d=(a.options.autoFormat&&window.intlTelInputUtils)?"+":"";a.telInput.val(d)}});setTimeout(function(){var e=a.telInput[0];if(a.isGoodBrowser){var d=a.telInput.val().length;e.setSelectionRange(d,d)}})}});this.telInput.on("blur"+this.ns,function(){if(a.options.autoHideDialCode){var d=a.telInput.val(),c=(d.charAt(0)=="+");if(c){var b=a._getNumeric(d);if(!b||a.selectedCountryData.dialCode==b){a.telInput.val("")}}a.telInput.off("keypress.plus"+a.ns)}if(a.options.autoFormat&&window.intlTelInputUtils&&a.telInput.val()!=a.telInput.data("focusVal")){a.telInput.trigger("change")}})},_getNumeric:function(a){return a.replace(/\D/g,"")},_getClean:function(a){var b=(a.charAt(0)=="+")?"+":"";return b+this._getNumeric(a)},_showDropdown:function(){this._setDropdownPosition();var a=this.countryList.children(".active");if(a.length){this._highlightListItem(a)}this.countryList.removeClass("hide");this.countryList.parents(".intl-tel-input").find("input").addClass("open");if(a.length){this._scrollTo(a)}this._bindDropdownListeners();this.selectedFlagInner.children(".arrow").addClass("up")},_setDropdownPosition:function(){var a=this.telInput.offset().top,c=$(window).scrollTop(),b=(a+this.telInput.outerHeight()+this.dropdownHeight<c+$(window).height()),d=(a-this.dropdownHeight>c);var e=(!b&&d)?"-"+(this.dropdownHeight-1)+"px":"";this.countryList.css("top",e)},_bindDropdownListeners:function(){var c=this;this.countryList.on("mouseover"+this.ns,".country",function(f){c._highlightListItem($(this))});this.countryList.on("click"+this.ns,".country",function(f){c._selectListItem($(this))});var a=true;$("html").on("click"+this.ns,function(f){if(!a){c._closeDropdown()}a=false});var d="",b=null;$(document).on("keydown"+this.ns,function(f){f.preventDefault();if(f.which==keys.UP||f.which==keys.DOWN){c._handleUpDownKey(f.which)}else{if(f.which==keys.ENTER){c._handleEnterKey()}else{if(f.which==keys.ESC){c._closeDropdown()}else{if((f.which>=keys.A&&f.which<=keys.Z)||f.which==keys.SPACE){if(b){clearTimeout(b)}d+=String.fromCharCode(f.which);c._searchForCountry(d);b=setTimeout(function(){d=""},1000)}}}}})},_handleUpDownKey:function(a){var c=this.countryList.children(".highlight").first();var b=(a==keys.UP)?c.prev():c.next();if(b.length){if(b.hasClass("divider")){b=(a==keys.UP)?b.prev():b.next()}this._highlightListItem(b);this._scrollTo(b)}},_handleEnterKey:function(){var a=this.countryList.children(".highlight").first();if(a.length){this._selectListItem(a)}},_searchForCountry:function(c){for(var a=0;a<this.countries.length;a++){if(this._startsWith(this.countries[a].name,c)){var b=this.countryList.children("[data-country-code="+this.countries[a].iso2+"]").not(".preferred");this._highlightListItem(b);this._scrollTo(b,true);break}}},_startsWith:function(d,c){return(d.substr(0,c.length).toUpperCase()==c)},_updateVal:function(d,e,b){var c;if(this.options.autoFormat&&window.intlTelInputUtils){if(!b&&this.options.nationalMode&&d.charAt(0)=="+"&&intlTelInputUtils.isValidNumber(d,this.selectedCountryData.iso2)){c=intlTelInputUtils.formatNumberByType(d,this.selectedCountryData.iso2,intlTelInputUtils.numberFormat.NATIONAL)}else{c=intlTelInputUtils.formatNumber(d,this.selectedCountryData.iso2,e)}var a=this.telInput.attr("maxlength");if(a&&c.length>a){c=c.substr(0,a)}}else{c=d}this.telInput.val(c)},_updateFlagFromNumber:function(e){if(this.options.nationalMode&&this.selectedCountryData&&this.selectedCountryData.dialCode=="1"&&e.charAt(0)!="+"){e="+1"+e}var b=this._getDialCode(e),c=null;if(b){var f=this.countryCodes[this._getNumeric(b)],a=(this.selectedCountryData&&$.inArray(this.selectedCountryData.iso2,f)!=-1);if(!a||this._isUnknownNanp(e,b)){if(f.indexOf(defaultCountryCode)>-1){c=defaultCountryCode}else{for(var d=0;d<f.length;d++){if(f[d]){c=f[d];break}}}}}else{if(e.charAt(0)=="+"){if(this._getNumeric(e).length){c=""}else{if(!this.selectedCountryData.iso2){c=this.options.defaultCountry.iso2}}}else{if(!this.selectedCountryData.iso2&&!e){c=this.options.defaultCountry.iso2}}}if(c!==null){this._selectFlag(c)}},_isUnknownNanp:function(b,a){return(a=="+1"&&this._getNumeric(b).length>=4)},_highlightListItem:function(a){this.countryListItems.removeClass("highlight");a.addClass("highlight")},_getCountryData:function(a,d,e){var b=(d)?allCountries:this.countries;for(var c=0;c<b.length;c++){if(b[c].iso2==a){return b[c]}}if(e){return null}else{throw new Error("No country data for '"+a+"'")}},_selectFlag:function(a){this.selectedCountryData=(a)?this._getCountryData(a,false,false):{};this.selectedFlagInner.attr("class","flag "+a);var b=(a)?this.selectedCountryData.name+": +"+this.selectedCountryData.dialCode:"Unknown";this.selectedFlagInner.parent().attr("title",b);this._updatePlaceholder();this.countryListItems.removeClass("active");if(a){this.countryListItems.children(".flag."+a).first().parent().addClass("active")}},_updatePlaceholder:function(){if(window.intlTelInputUtils&&!this.hadInitialPlaceholder){var a=this.selectedCountryData.iso2;var b;if(noNumberPlaceHolder){b=-1}else{b=intlTelInputUtils.numberType[this.options.numberType||"FIXED_LINE"]}var c=(a)?intlTelInputUtils.getExampleNumber(a,this.options.nationalMode,b):"";this.telInput.attr("placeholder",c)}},_selectListItem:function(b){var a=b.attr("data-country-code");this._selectFlag(a);this._closeDropdown();this._updateDialCode(b.attr("data-dial-code"),true);this.telInput.trigger("change");this.telInput.focus()},_closeDropdown:function(){this.countryList.addClass("hide");this.countryList.parents(".intl-tel-input").find("input").removeClass("open");this.selectedFlagInner.children(".arrow").removeClass("up");$(document).off(this.ns);$("html").off(this.ns);this.countryList.off(this.ns)},_scrollTo:function(g,l){var a=this.countryList,k=a.height(),e=a.offset().top,j=e+k,h=g.outerHeight(),d=g.offset().top,i=d+h,b=d-e+a.scrollTop(),c=(k/2)-(h/2);if(d<e){if(l){b-=c}a.scrollTop(b)}else{if(i>j){if(l){b+=c}var f=k-h;a.scrollTop(b-f)}}},_updateDialCode:function(d,a){var c=this.telInput.val(),e;d="+"+d;if(this.options.nationalMode&&c.charAt(0)!="+"){e=c}else{if(c){var f=this._getDialCode(c);if(f.length>1){e=c.replace(f,d)}else{var b=(c.charAt(0)!="+")?$.trim(c):"";e=d+b}}else{e=(!this.options.autoHideDialCode||a)?d:""}}this._updateVal(e,a)},_getDialCode:function(d){var a="";if(d.charAt(0)=="+"){var e="";for(var b=0;b<d.length;b++){var f=d.charAt(b);if($.isNumeric(f)){e+=f;if(this.countryCodes[e]){a=d.substr(0,b+1)}if(e.length==4){break}}}}return a},destroy:function(){this._closeDropdown();this.telInput.off(this.ns);this.selectedFlagInner.parent().off(this.ns);this.telInput.closest("label").off(this.ns);var a=this.telInput.parent();a.before(this.telInput).remove()},getNumber:function(a){if(window.intlTelInputUtils){return intlTelInputUtils.formatNumberByType(this.telInput.val(),this.selectedCountryData.iso2,a)}return""},getNumberType:function(){if(window.intlTelInputUtils){return intlTelInputUtils.getNumberType(this.telInput.val(),this.selectedCountryData.iso2)}return -99},getSelectedCountryData:function(){return this.selectedCountryData||{}},getValidationError:function(){if(window.intlTelInputUtils){return intlTelInputUtils.getValidationError(this.telInput.val(),this.selectedCountryData.iso2)}return -99},isValidNumber:function(){var c=$.trim(this.telInput.val()),a=(this.options.nationalMode)?this.selectedCountryData.iso2:"",b=/[a-zA-Z]/.test(c);if(!b&&window.intlTelInputUtils){return intlTelInputUtils.isValidNumber(c,a)}return false},loadUtils:function(b){var a=b||this.options.utilsScript;if(!$.fn[pluginName].loadedUtilsScript&&a){$.fn[pluginName].loadedUtilsScript=true;$.ajax({url:a,success:function(){$(".intl-tel-input input").intlTelInput("utilsLoaded")},dataType:"script",cache:true})}},selectCountry:function(a){a=a.toLowerCase();if(!this.selectedFlagInner.hasClass(a)){this._selectFlag(a);this._updateDialCode(this.selectedCountryData.dialCode,false)}},setNumber:function(b,c,a){if(!this.options.nationalMode&&b.charAt(0)!="+"){b="+"+b}this._updateFlagFromNumber(b);this._updateVal(b,c,a)},utilsLoaded:function(){if(this.options.autoFormat&&this.telInput.val()){this._updateVal(this.telInput.val())}this._updatePlaceholder()}};$.fn[pluginName]=function(b){var a=arguments;if(b===undefined||typeof b==="object"){return this.each(function(){if(!$.data(this,"plugin_"+pluginName)){$.data(this,"plugin_"+pluginName,new Plugin(this,b))}})}else{if(typeof b==="string"&&b[0]!=="_"&&b!=="init"){var c;this.each(function(){var d=$.data(this,"plugin_"+pluginName);if(d instanceof Plugin&&typeof d[b]==="function"){c=d[b].apply(d,Array.prototype.slice.call(a,1))}if(b==="destroy"){$.data(this,"plugin_"+pluginName,null)}});return c!==undefined?c:this}}};$.fn[pluginName].getCountryData=function(){return allCountries};